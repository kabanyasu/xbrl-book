# 事前準備

## 本章の目的
本章ではプログラムを使用するために、”プログラミングで利用する「EDINET API」の準備”と”プログラムを動作させるためのソフトウェアの環境構築”について説明します。

もうすでにEDINET APIの利用方法をご存じの方・Pythonが利用可能な状態にある方は、この章は読ますに次章から読み進めていただいて大丈夫です。

なお、この記事の大部分はEDINETの公式から発表されている「EDINET API仕様書 version2」を参考に執筆しております。

## EDINET APIを使えるようにしよう

まず、有報をダウンロードするために必須のAPI[^1]についてです。

[^1]: アプリケーション・プログラミング・インターフェースの略。ソフトウェアやプログラム、Webサービス間をつなぐインターフェースのこと。

EDINET APIとは、使用者が直接EDINETのウェブページに行くのではなく、プログラムを介してEDINETのデータベースから効率的にデータを取得できるAPIです。EDINET APIにより、EDINET利用者は効率的に開示情報を取得することが可能となります。

そんなEDINET APIは以下の2種類です。

- 書類一覧API
- 書類取得API

書類一覧APIは提出された書類を把握するためのAPIです。こちらはEDINETに提出された書類の一覧を取得するAPIとなっています。書類一覧APIを用いることで、日付ごとの提出書類の基本情報を参照し情報を取得するというわけです。

書類取得APIは提出された書類を取得するためのAPIです。
取得する書類の種類を指定することができます。このAPIを活用すると、ダウンロードするファイル名を企業名にしたり、フィルタリングした企業の有報だけダウンロードするといったことが可能になります。

EDIENT APIを使用するにはアカウントを作成し、APIキーというものを発行し、コードに書き込む必要があります。 

### 注意点

アカウント作成、APIキーを取得する際にいくつか注意点があります。
正しい手段を踏んでもこの注意点の項目ができていないと、うまくアカウント作成やAPIキー取得が出来ないこともあるので確認してください。

公式のEDINET API仕様書ではMicrosoft Edgeでの利用方法が詳しく記載されていましたが、Google Chromeでの設定方法の記載がなく利用者も多いと思うので今回はChromeの説明をします。

Microsoft Edgeご利用の方は以下のURLからダウンロードできるEDINET_API仕様書を参考にしてください。


▼ EDINET操作ガイド　EDINET API仕様書(Version2)

https://disclosure2dl.edinet-fsa.go.jp/guide/static/disclosure/WZEK0110.html


#### ポップアップの設定

Google Chromeを開き、右上の三点リーダーをクリックし、「設定」をクリックします。

<img height=300 alt="Chromeの設定を開く" src="images/0301_chromeの設定をクリック.png">

画面の左のサイドバーから「プライバシーとセキュリティ」をクリックします。 次に画面中央から「サイトの設定」をクリックします。

![サイトの設定を開く](images/0302_サイトの設定をクリック.png)

コンテンツの中の「ポップアップとリダイレクト」をクリックします。

![ポップアップとリダイレクトを開く](images/0303_ポップアップとリダイレクトをクリック.png)

動作のカスタマイズで「ポップアップの送信やリダイレクトの使用を許可するサイト」にEDINET APIサイトのリンクを入れます。

![ポップアップサイトの追加](images/0304_ポップアップサイトの追加.png)

「サイトの追加」画面で「https://api.edinet-fsa.go.jp」を入力し、追加ボタンをクリックします。

![EDIENT APIのサイトURLを追加](images/0305_サイトの追加.png)

これでポップアップの設定は完了です。

#### JavaScriptの設定

上記と同じくChromeの設定を開き、「セキュリティ」をクリックします。

![セキュリティの設定を開く](images/0306_セキュリティの設定.png)

「V8のセキュリティを管理する」をクリックします。

![V8オプティマイザーを許可](images/0307_v8設定.png)

デフォルトの動作が「サイトでのV8オプティマイザーの使用を許可する」にチェックが入っているか確認してください。

以上で、JavaScriptの設定は完了です。 

#### Cookieの設定

同じく設定画面を開き、「サードパーティCookie」をクリックします。

<img height=300 alt="サードパーティCookieの設定を開く" src="images/0308_サードパーティクッキーをクリック.png">

「サードパーティCookieを許可する」にチェックが入っていることを確認します。

<img height=500 alt="サードパーティのCookieを許可する" src="images/0309_サードパーティ設定.png">

「サードパーティCookieを許可する」にチェックが入っていることを確認します。

以上でCookieの設定は完了となります。 

### アカウント作成

アカウントを作成する場合には、以下のURLにアクセスし、サインイン画面を表示させます。

https://api.edinet-fsa.go.jp/api/auth/index.aspx?mode=1

サインイン画面が表示されたら下の「今すぐサインアップ」をクリックします。

<img width=300 alt="EDINET APIのサインイン画面" src="images/0310_サインイン画面.png">

サインアップ画面の上のフォームにメールアドレスを入力し、「確認コードを送信」をクリックします。

<img width=300 alt="メールアドレスを入力し確認コードを受信する" src="images/0311_ユーザー詳細入力画面1.png">

確認コード入力欄にメールに送られてくる確認コードを入力し、「コードの確認」をクリックします。

「新しいコードを送信」は確認コードの再送の際にクリックしてください。

<img width=300 alt="確認コードを入力" src="images\0312_ユーザー詳細入力画面2.jpg">

コードが正しく受理されると確認コード入力欄がなくなります。 次に下段のパスワードを設定していきます。 「新しいパスワード」と「新しいパスワードを確認してください」のフォームには同一のパスワードの設定してください。

パスワードはパスワードポリシーに沿っていないとエラーが表示されます。もし表示された際はそのエラーに沿って修正してください。

<img width=300 alt="ユーザーパスワードを入力" src="images\0313_ユーザーパスワード入力画面.png">

パスワードが受理されると、次に多要素認証に移ります。

まず「国コード」と「電話番号」をそれぞれ入力したのち、以下のいずれかの多要素認証を行います。

1. SMSによる本人確認 SMSにて通知される確認コードを多要素確認コード入力画面に入力して認証を行う。

2. 自動音声による本人確認 登録した電話番号に発信される自動音声通話を受け取り、音声ガイドに従い、テンキーで「#」を入力することにより認証を行う。

3. SMSか電話でコードを受け取る。

<img width=300 alt="多要素認証を行う" src="images\0314_多要素認証.png">

SMSにて受け取った確認コードを入力するとAPIキー発行画面が表示されます。

<img width=300 alt="多要素認証確認コードを入力" src="images\0315_多要素認証確認コード.png">

以上でアカウントの作成が完了です。

続けてAPIキーの発行についてです。

多要素認証でのサインイン後にAPIキー発行画面がポップアップ画面で表示されます。

 ※ポップアップ画面が表示されない場合は、事前準備の設定のどれかが正しく設定できていない可能性があります。見直ししてみてください。

連絡先を入力し、「連絡先登録（Save）」をクリックします。

 ※2回目以降は以下の画像のように「連絡先変更（Save）」となります。

![APIキー発行画面](images/0316_APIキー発行画面.png)

確認画面の「OK」を2つ押します。

<img width=450 alt="連絡先保存確認画面" src="images\0317_連絡先保存確認画面.png">

<img width=450 alt="連絡先保存完了画面" src="images\0318_連絡先保存完了画面.png">

API発行画面にAPIキーが表示されます。 

このAPIキーはコードの中に入れるためコピペできるようにしておいてください。

![APIキーを取得](images/0319_連絡先発行.png)

## コードエディタを使おう
次にプログラムを記述し実行する作業場「コードエディタ」をインストールし、設定していきます。

### VS Codeを使えるようにしよう

コードエディタは様々なものが存在しますが、世の中で広く使われている「VS Code」というものを使用していきます。では、VS Codeのインストール手順を確認していきましょう。

注意：本書ではwindowsでのセットアップを想定しています

#### VS Code公式サイトに移動し、インストーラーをダウンロード

以下のURLに移動して「Download for Windows」をクリックしてください。

https://code.visualstudio.com/

「VSCodeUserSetup-x64-1.94.0.exe」というファイルがダウンロードできれば成功です。

#### インストーラーによるセットアップ

先ほどダウンロードした.exeファイルをダブルクリックして開いてください。

以下の画像のような画面が出現します。

「同意する」を選択してから「次へ(N)>」をクリックします。

![VS Code 同意画面](images/0320_VSコード同意画面.png)

追加の設定画面が表示されます。

全ての項目にチェックをし、「次へ(N)>」をクリックします。

![VS Codeインストール時に実行するタスクを選択](images/0321_VSコードセットアップ項目.png)

今まで選択した項目と間違えがなければ、「インストール(I)」をクリックしてください。

ソフトウェアのインストールが開始されます。

![VS Codeインストール](images/0322_VSコードインストール.png)

#### ソフトウェア内でのセットアップ

インストールされた「VS Code」を開いてください。初期設定では言語が英語になっているため、日本語化を行います。画面左側にある「拡張機能」ボタンを押してください。

![VS Code拡張機能を追加](images/0323_VSコード拡張機能ボタン.png)

検索バーに「japanese」と検索し、一番上に表示される拡張機能を「インストール」をクリックし、日本語化する拡張機能をインストールしましょう。その後右下に再起動を促すポップアップが表示されます。「Change Language and Restart」と書かれたボタンがあるのでクリックして再起動することで、VS Codeが日本語化されます。

![VS Codeを日本語にする](images/0324_VSコード日本語化.png)

#### VS CodeでのPythonのセットアップ

本書ではプログラミング言語は「Python」を使用します。よってVS CodeでPythonが使えるようにセットアップを行いましょう。まずはPython本体のインストールです

以下のサイトから「Python 3.12.3」 の「Python installer(64-bit)」をダウンロードしてください。筆者が現時点でプログラム動作確認済みのバージョンです。以下のリンクを踏むことで直接ダウンロードが行われます。

https://www.python.org/ftp/python/3.12.3/python-3.12.3-amd64.exe

「Python-3.12.3-amd64.exe」というファイルがダウンロードされるので、そのファイルを開いてください。以下の画像のような画面が出現します。

必ず「Add python.exe to PATH」にチェックを付けて、「Install Now」をクリックしてください。

pcにPythonがダウンロードされます。

 ※書かれているバージョンは違うものですが、画面は同じものが出てきます。

![Pythonをインストールする](images/0325_Pythoninstaller画面.png)

次にVS CodeでのPythonの設定を行います。VS Codeを開き、もう一度拡張機能のインストールを行います。検索バーに「python」と入力し、一番上に出てくる拡張機能をインストールしてください。

![VS CodeにPythonの拡張機能を追加](images/0326_VSコードPython拡張機能.png)

以上で最低限の設定は完了です。

あとはご自身でフォルダを作成し、「ファイル名.py」でPythonファイルを作成することでPythonコードを実行させることができます。

## まとめ

以上で次章以降においてプログラミングをするための準備が整いました。プログラミングを利用することでより効率的に分析を行うことが可能になります。

次の章では、データを分析するための大量のデータを収集してみます。1カ月単位の大量の有報を自動で取得できるようになりましょう。
